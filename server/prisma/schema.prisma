generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model GlobalSettings {
  id            Int      @id @default(1)
  facebookUrl   String?
  instagramUrl  String?
  whatsappUrl   String?
  websiteUrl    String?
  contactPhone  String?
  contactEmail  String?
  updatedAt     DateTime @updatedAt
}

model School {
  id                    Int                 @id @default(autoincrement())
  slug                  String              @unique // e.g. "darul-quran"
  name                  String
  address               String?
  phone                 String?
  email                 String?
  motto                 String?
  logoUrl               String?
  openingHours          String?             @default("Mon - Fri: 8:00 AM - 4:00 PM")
  welcomeTitle          String?             @default("Building a Brighter Future Together")
  welcomeMessage        String?             @default("Providing a supportive and innovative environment where every student can achieve their full potential and prepare for success in an ever-changing world.")
  primaryColor          String              @default("#1e40af")
  secondaryColor        String              @default("#3b82f6")
  accentColor           String              @default("#60a5fa")
  
  // Settings & Integrations
  paystackPublicKey     String?
  paystackSecretKey     String?
  flutterwavePublicKey  String?
  flutterwaveSecretKey  String?
  enableOnlinePayment   Boolean             @default(false)
  
  // Communication
  emailUser             String?
  emailPassword         String?
  emailHost             String?
  emailPort             Int?                @default(465)
  emailSecure           Boolean             @default(true)
  smsUsername           String?
  smsApiKey             String?
  smsSenderId           String?
  enableSMS             Boolean             @default(false)
  
  // Portal Links
  facebookUrl           String?
  instagramUrl          String?
  whatsappUrl           String?
  academicCalendarUrl   String?
  eLibraryUrl           String?
  alumniNetworkUrl      String?
  brochureFileUrl       String?
  admissionGuideFileUrl String?

  // License info
  licenseKey            String?             @unique
  isActivated           Boolean             @default(false)
  packageType           String?             @default("basic")
  maxStudents           Int?                @default(500)
  expiresAt             DateTime?

  // Academic Configuration
  assignment1Weight     Int                 @default(5)
  assignment2Weight     Int                 @default(5)
  test1Weight           Int                 @default(10)
  test2Weight           Int                 @default(10)
  examWeight            Int                 @default(70)

  isSetupComplete       Boolean             @default(false)
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  // Data Ownership
  users                 User[]
  teachers              Teacher[]
  parents               Parent[]
  students              Student[]
  academicSessions      AcademicSession[]
  terms                 Term[]
  classes               Class[]
  subjects              Subject[]
  classSubjects         ClassSubject[]
  teacherAssignments    TeacherAssignment[]
  results               Result[]
  attendanceRecords     AttendanceRecord[]
  timetables            Timetable[]
  notices               Notice[]
  homeworks             Homework[]
  learningResources     LearningResource[]
  feeRecords            FeeRecord[]
  feePayments           FeePayment[]
  examCards             ExamCard[]
  classFeeStructures    ClassFeeStructure[]
  onlinePayments        OnlinePayment[]
  messages              ParentTeacherMessage[]
  cbtExams              CBTExam[]
  cbtQuestions          CBTQuestion[]
  cbtResults            CBTResult[]
  psychomotorDomains    PsychomotorDomain[]
  studentReportCards    StudentReportCard[]
  galleryImages         GalleryImage[]
  quranTargets          QuranTarget[]
  quranRecords          QuranRecord[]
  newsEvents            NewsEvent[]
  alumni                Alumni[]
  alumniEvents          AlumniEvent[]
  alumniStories         AlumniStory[]
  alumniDonations       AlumniDonation[]
  promotionHistory      PromotionHistory[]
  homeworkSubmissions   HomeworkSubmission[]
  auditLogs             AuditLog[]
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  schoolId  Int
  userId    Int?
  action    String
  resource  String
  details   String?
  ipAddress String?
  createdAt DateTime @default(now())
  
  school    School   @relation(fields: [schoolId], references: [id])
}

model User {
  id                 Int                 @id @default(autoincrement())
  schoolId           Int                 // <-- Link to School
  username           String
  passwordHash       String
  email              String?
  role               String
  firstName          String
  lastName           String
  isActive           Boolean             @default(true)
  mustChangePassword Boolean             @default(false)
  createdAt          DateTime            @default(now())
  
  school             School              @relation(fields: [schoolId], references: [id])
  
  cbtExamsCreated    CBTExam[]
  classesAsTeacher   Class[]             @relation("ClassTeacher")
  paymentsRecorded   FeePayment[]        @relation("PaymentRecorder")
  feeClearances      FeeRecord[]         @relation("FeeClearance")
  GalleryImage       GalleryImage[]
  homeworks          Homework[]
  resources          LearningResource[]
  NewsEvent          NewsEvent[]
  notices            Notice[]
  parent             Parent?
  student            Student?
  teacher            Teacher?
  teacherAssignments TeacherAssignment[]
  quranRecords       QuranRecord[]      @relation("QuranTeacher")
  gradedSubmissions  HomeworkSubmission[]

  @@unique([schoolId, username]) // Username unique PER school
  @@unique([schoolId, email])    // Email unique PER school
}

model Parent {
  id        Int       @id @default(autoincrement())
  schoolId  Int
  userId    Int       @unique
  phone     String
  address   String?
  createdAt DateTime  @default(now())
  
  school    School    @relation(fields: [schoolId], references: [id])
  user      User      @relation(fields: [userId], references: [id])
  students  Student[]

  @@unique([schoolId, phone])
}

model Student {
  id                  Int                 @id @default(autoincrement())
  schoolId            Int
  userId              Int                 @unique
  parentId            Int?
  admissionNumber     String
  classId             Int?
  dateOfBirth         DateTime?
  gender              String?
  stateOfOrigin       String?
  nationality         String?             @default("Nigerian")
  address             String?
  photoUrl            String?
  parentGuardianName  String?
  parentGuardianPhone String?
  parentEmail         String?
  bloodGroup          String?
  genotype            String?
  disability          String?
  name                String?
  rollNo              String?             
  class               String?
  parentPhone         String?
  createdAt           DateTime            @default(now())
  middleName          String?
  status              String              @default("active") // active, graduated, withdrawn, alumi
  clubs               String?
  isScholarship       Boolean             @default(false)
  isExamRestricted    Boolean             @default(false)
  examRestrictionReason String?
  
  school              School              @relation(fields: [schoolId], references: [id])
  alumniProfile       Alumni?
  attendanceRecords   AttendanceRecord[]
  cbtResults          CBTResult[]
  examCards           ExamCard[]
  feeRecords          FeeRecord[]
  onlinePayments      OnlinePayment[]
  results             Result[]
  classModel          Class?              @relation(fields: [classId], references: [id])
  parent              Parent?             @relation(fields: [parentId], references: [id])
  user                User                @relation(fields: [userId], references: [id])
  reportCards         StudentReportCard[]
  promotionHistory    PromotionHistory[]
  quranRecords        QuranRecord[]
  homeworkSubmissions HomeworkSubmission[]

  @@unique([schoolId, admissionNumber])
  @@unique([schoolId, rollNo])
}

model Teacher {
  id             Int      @id @default(autoincrement())
  schoolId       Int
  userId         Int      @unique
  staffId        String   
  specialization String?
  createdAt      DateTime @default(now())
  photoUrl       String?
  
  school         School   @relation(fields: [schoolId], references: [id])
  user           User     @relation(fields: [userId], references: [id])

  @@unique([schoolId, staffId])
}

model AcademicSession {
  id                Int                 @id @default(autoincrement())
  schoolId          Int
  name              String
  startDate         DateTime
  endDate           DateTime
  isCurrent         Boolean             @default(false)
  createdAt         DateTime            @default(now())
  
  school            School              @relation(fields: [schoolId], references: [id])
  
  attendanceRecords AttendanceRecord[]
  cbtExams          CBTExam[]
  feeStructures     ClassFeeStructure[]
  examCards         ExamCard[]
  feeRecords        FeeRecord[]
  results           Result[]
  reportCards       StudentReportCard[]
  quranTargets      QuranTarget[]
  terms             Term[]
  promotionHistory  PromotionHistory[]

  @@unique([schoolId, name])
}

model Term {
  id                Int                 @id @default(autoincrement())
  schoolId          Int
  academicSessionId Int
  name              String
  startDate         DateTime
  endDate           DateTime
  isCurrent         Boolean             @default(false)
  createdAt         DateTime            @default(now())
  
  school            School              @relation(fields: [schoolId], references: [id])
  attendanceRecords AttendanceRecord[]
  cbtExams          CBTExam[]
  feeStructures     ClassFeeStructure[]
  examCards         ExamCard[]
  feeRecords        FeeRecord[]
  results           Result[]
  reportCards       StudentReportCard[]
  quranTargets      QuranTarget[]
  academicSession   AcademicSession     @relation(fields: [academicSessionId], references: [id])

  @@unique([schoolId, academicSessionId, name])
}

model Class {
  id                 Int                 @id @default(autoincrement())
  schoolId           Int
  name               String
  arm                String?
  classTeacherId     Int?
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  isResultPublished  Boolean             @default(false)
  expectedSubjects   Int                 @default(0)
  
  school             School              @relation(fields: [schoolId], references: [id])
  
  attendanceRecords  AttendanceRecord[]
  cbtExams           CBTExam[]
  classTeacher       User?               @relation("ClassTeacher", fields: [classTeacherId], references: [id])
  feeStructures      ClassFeeStructure[]
  homeworks          Homework[]
  resources          LearningResource[]
  results            Result[]
  students           Student[]
  reportCards        StudentReportCard[]
  timetables         Timetable[]
  fromPromotions     PromotionHistory[]  @relation("FromClass")
  toPromotions       PromotionHistory[]  @relation("ToClass")
  classSubjects      ClassSubject[]
  quranTargets       QuranTarget[]

  @@unique([schoolId, name, arm])
}

model Subject {
  id                 Int                 @id @default(autoincrement())
  schoolId           Int
  name               String
  code               String?
  createdAt          DateTime            @default(now())
  
  school             School              @relation(fields: [schoolId], references: [id])
  
  cbtExams           CBTExam[]
  homeworks          Homework[]
  resources          LearningResource[]
  results            Result[]
  timetables         Timetable[]
  classSubjects      ClassSubject[]

  @@unique([schoolId, code])
}

model ClassSubject {
  id                 Int                 @id @default(autoincrement())
  schoolId           Int
  classId            Int
  subjectId          Int
  createdAt          DateTime            @default(now())
  
  school             School              @relation(fields: [schoolId], references: [id])
  class              Class               @relation(fields: [classId], references: [id], onDelete: Cascade)
  subject            Subject             @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  teacherAssignments TeacherAssignment[]

  @@unique([schoolId, classId, subjectId])
}

model TeacherAssignment {
  id             Int          @id @default(autoincrement())
  schoolId       Int
  teacherId      Int
  classSubjectId Int
  createdAt      DateTime     @default(now())
  
  school         School       @relation(fields: [schoolId], references: [id])
  teacher        User         @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  classSubject   ClassSubject @relation(fields: [classSubjectId], references: [id], onDelete: Cascade)

  @@unique([schoolId, teacherId, classSubjectId])
}

model Result {
  id                Int             @id @default(autoincrement())
  schoolId          Int
  studentId         Int
  academicSessionId Int
  termId            Int
  classId           Int
  subjectId         Int
  assignment1Score  Float?
  assignment2Score  Float?
  test1Score        Float?
  test2Score        Float?
  examScore         Float?
  totalScore        Float
  grade             String?
  positionInClass   Int?
  classAverage      Float?
  teacherId         Int?
  isSubmitted       Boolean         @default(false)
  submittedAt       DateTime?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  
  school            School          @relation(fields: [schoolId], references: [id])
  subject           Subject         @relation(fields: [subjectId], references: [id])
  class             Class           @relation(fields: [classId], references: [id])
  term              Term            @relation(fields: [termId], references: [id])
  academicSession   AcademicSession @relation(fields: [academicSessionId], references: [id])
  student           Student         @relation(fields: [studentId], references: [id])

  @@unique([schoolId, studentId, subjectId, termId, academicSessionId])
}

model AttendanceRecord {
  id                Int             @id @default(autoincrement())
  schoolId          Int
  studentId         Int
  classId           Int
  academicSessionId Int
  termId            Int
  date              DateTime
  status            String          @default("present")
  notes             String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  
  school            School          @relation(fields: [schoolId], references: [id])
  term              Term            @relation(fields: [termId], references: [id])
  academicSession   AcademicSession @relation(fields: [academicSessionId], references: [id])
  class             Class           @relation(fields: [classId], references: [id])
  student           Student         @relation(fields: [studentId], references: [id])

  @@unique([schoolId, studentId, date])
}

model Timetable {
  id          Int      @id @default(autoincrement())
  schoolId    Int
  classId     Int
  subjectId   Int?
  dayOfWeek   String
  startTime   String
  endTime     String
  type        String
  isPublished Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  school      School   @relation(fields: [schoolId], references: [id])
  subject     Subject? @relation(fields: [subjectId], references: [id])
  class       Class    @relation(fields: [classId], references: [id])

  @@index([schoolId, classId, dayOfWeek])
}

model Notice {
  id        Int      @id @default(autoincrement())
  schoolId  Int
  title     String
  content   String
  audience  String   @default("all")
  isActive  Boolean  @default(true)
  authorId  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  school    School   @relation(fields: [schoolId], references: [id])
  author    User     @relation(fields: [authorId], references: [id])
}

model Homework {
  id          Int       @id @default(autoincrement())
  schoolId    Int
  classId     Int
  subjectId   Int
  teacherId   Int
  title       String
  description String?
  fileUrl     String?
  fileName    String?
  dueDate     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  school      School    @relation(fields: [schoolId], references: [id])
  teacher     User      @relation(fields: [teacherId], references: [id])
  subject     Subject   @relation(fields: [subjectId], references: [id])
  class       Class     @relation(fields: [classId], references: [id])
  submissions HomeworkSubmission[]
}

model HomeworkSubmission {
  id           Int      @id @default(autoincrement())
  schoolId     Int
  homeworkId   Int
  studentId    Int
  fileUrl      String
  fileName     String
  submittedAt  DateTime @default(now())
  grade        String?
  feedback     String?
  gradedBy     Int?

  school       School   @relation(fields: [schoolId], references: [id])
  homework     Homework @relation(fields: [homeworkId], references: [id])
  student      Student  @relation(fields: [studentId], references: [id])
  grader       User?    @relation(fields: [gradedBy], references: [id])

  @@unique([homeworkId, studentId])
}

model LearningResource {
  id          Int      @id @default(autoincrement())
  schoolId    Int
  classId     Int
  subjectId   Int
  teacherId   Int
  title       String
  description String?
  fileUrl     String?
  fileName    String?
  type        String   @default("note")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  school      School   @relation(fields: [schoolId], references: [id])
  teacher     User     @relation(fields: [teacherId], references: [id])
  subject     Subject  @relation(fields: [subjectId], references: [id])
  class       Class    @relation(fields: [classId], references: [id])
}

model FeeRecord {
  id                Int             @id @default(autoincrement())
  schoolId          Int
  studentId         Int
  academicSessionId Int
  termId            Int
  openingBalance    Float           @default(0)  // Balance brought forward from previous terms
  expectedAmount    Float
  paidAmount        Float           @default(0)
  balance           Float
  isClearedForExam  Boolean         @default(true)
  clearedBy         Int?
  clearedAt         DateTime?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  
  school            School          @relation(fields: [schoolId], references: [id])
  payments          FeePayment[]
  clearedByUser     User?           @relation("FeeClearance", fields: [clearedBy], references: [id])
  term              Term            @relation(fields: [termId], references: [id])
  academicSession   AcademicSession @relation(fields: [academicSessionId], references: [id])
  student           Student         @relation(fields: [studentId], references: [id])
  onlinePayments    OnlinePayment[]

  @@unique([schoolId, studentId, termId, academicSessionId])
}

model FeePayment {
  id             Int       @id @default(autoincrement())
  schoolId       Int
  feeRecordId    Int
  amount         Float
  paymentMethod  String    @default("cash")
  reference      String?
  notes          String?
  paymentDate    DateTime  @default(now())
  recordedBy     Int
  createdAt      DateTime  @default(now())
  
  school         School    @relation(fields: [schoolId], references: [id])
  recordedByUser User      @relation("PaymentRecorder", fields: [recordedBy], references: [id])
  feeRecord      FeeRecord @relation(fields: [feeRecordId], references: [id])
}

model ExamCard {
  id                Int             @id @default(autoincrement())
  schoolId          Int
  studentId         Int
  academicSessionId Int
  termId            Int
  cardNumber        String          
  issuedAt          DateTime        @default(now())
  
  school            School          @relation(fields: [schoolId], references: [id])
  term              Term            @relation(fields: [termId], references: [id])
  academicSession   AcademicSession @relation(fields: [academicSessionId], references: [id])
  student           Student         @relation(fields: [studentId], references: [id])

  @@unique([schoolId, cardNumber])
  @@unique([schoolId, studentId, termId, academicSessionId])
}

model ClassFeeStructure {
  id                Int             @id @default(autoincrement())
  schoolId          Int
  classId           Int
  academicSessionId Int
  termId            Int
  amount            Float
  description       String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  
  school            School          @relation(fields: [schoolId], references: [id])
  term              Term            @relation(fields: [termId], references: [id])
  academicSession   AcademicSession @relation(fields: [academicSessionId], references: [id])
  class             Class           @relation(fields: [classId], references: [id])

  @@unique([schoolId, classId, termId, academicSessionId])
}

model License {
  id            Int       @id @default(autoincrement())
  licenseKey    String    @unique
  schoolName    String
  contactPerson String
  contactEmail  String
  contactPhone  String
  packageType   String
  maxStudents   Int
  isActive      Boolean   @default(true)
  activatedAt   DateTime?
  expiresAt     DateTime?
  lastCheckedAt DateTime?
  machineId     String?
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

// SchoolSettings model removed - merged into School

model OnlinePayment {
  id               Int       @id @default(autoincrement())
  schoolId         Int
  feeRecordId      Int
  studentId        Int
  amount           Float
  provider         String
  reference        String    
  status           String    @default("pending")
  paidAt           DateTime?
  providerResponse String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  
  school           School    @relation(fields: [schoolId], references: [id])
  student          Student   @relation(fields: [studentId], references: [id])
  feeRecord        FeeRecord @relation(fields: [feeRecordId], references: [id])

  @@unique([schoolId, reference])
}

model ParentTeacherMessage {
  id              Int       @id @default(autoincrement())
  schoolId        Int
  senderId        Int
  receiverId      Int
  senderRole      String
  studentId       Int
  subject         String
  message         String
  messageType     String    @default("general")
  isRead          Boolean   @default(false)
  readAt          DateTime?
  parentMessageId Int?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  school          School    @relation(fields: [schoolId], references: [id])
}

model CBTExam {
  id                Int             @id @default(autoincrement())
  schoolId          Int
  title             String
  description       String?
  classId           Int
  subjectId         Int
  teacherId         Int
  academicSessionId Int
  termId            Int
  durationMinutes   Int             @default(60)
  totalMarks        Float           @default(100)
  startDate         DateTime?
  endDate           DateTime?
  isPublished       Boolean         @default(false)
  examType          String?         @default("examination") // first_test, second_test, examination
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  
  school            School          @relation(fields: [schoolId], references: [id])
  term              Term            @relation(fields: [termId], references: [id])
  academicSession   AcademicSession @relation(fields: [academicSessionId], references: [id])
  teacher           User            @relation(fields: [teacherId], references: [id])
  subject           Subject         @relation(fields: [subjectId], references: [id])
  class             Class           @relation(fields: [classId], references: [id])
  questions         CBTQuestion[]
  results           CBTResult[]
}

model CBTQuestion {
  id            Int      @id @default(autoincrement())
  schoolId      Int
  examId        Int
  questionText  String
  questionType  String   @default("multiple_choice")
  options       String
  correctOption String
  points        Float    @default(1.0)
  createdAt     DateTime @default(now())
  
  school        School   @relation(fields: [schoolId], references: [id])
  exam          CBTExam  @relation(fields: [examId], references: [id], onDelete: Cascade)
}

model CBTResult {
  id             Int       @id @default(autoincrement())
  schoolId       Int
  examId         Int
  studentId      Int
  score          Float
  totalQuestions Int
  correctAnswers Int
  startedAt      DateTime  @default(now())
  submittedAt    DateTime?
  answers        String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  
  school         School    @relation(fields: [schoolId], references: [id])
  student        Student   @relation(fields: [studentId], references: [id])
  exam           CBTExam   @relation(fields: [examId], references: [id])

  @@unique([schoolId, examId, studentId])
}

model PsychomotorDomain {
  id          Int     @id @default(autoincrement())
  schoolId    Int
  name        String
  description String?
  maxScore    Int     @default(5)
  isActive    Boolean @default(true)
  
  school      School  @relation(fields: [schoolId], references: [id])

  @@unique([schoolId, name])
}

model StudentReportCard {
  id                 Int             @id @default(autoincrement())
  schoolId           Int
  studentId          Int
  academicSessionId  Int
  termId             Int
  classId            Int
  formMasterRemark   String?
  principalRemark    String?
  psychomotorRatings String?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  
  school             School          @relation(fields: [schoolId], references: [id])
  class              Class           @relation(fields: [classId], references: [id])
  term               Term            @relation(fields: [termId], references: [id])
  academicSession    AcademicSession @relation(fields: [academicSessionId], references: [id])
  student            Student         @relation(fields: [studentId], references: [id])

  @@unique([schoolId, studentId, termId, academicSessionId])
}

model GalleryImage {
  id          Int      @id @default(autoincrement())
  schoolId    Int
  title       String
  description String?
  imageUrl    String
  category    String
  uploadedBy  Int
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  
  school      School   @relation(fields: [schoolId], references: [id])
  User        User     @relation(fields: [uploadedBy], references: [id])
}

model NewsEvent {
  id          Int       @id @default(autoincrement())
  schoolId    Int
  title       String
  content     String
  type        String
  eventDate   DateTime?
  imageUrl    String?
  isPublished Boolean   @default(false)
  authorId    Int
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now())
  
  school      School    @relation(fields: [schoolId], references: [id])
  User        User      @relation(fields: [authorId], references: [id])
}

model Alumni {
  id               Int      @id @default(autoincrement())
  schoolId         Int
  studentId        Int      @unique
  graduationYear   Int
  currentJob       String?
  currentCompany   String?
  university       String?
  courseOfStudy    String?
  bio              String?
  isPublic         Boolean  @default(true)
  linkedinUrl      String?
  twitterUrl       String?
  portfolioUrl     String?
  skills           String?  // Comma separated
  achievements     String?
  profilePicture   String?
  alumniId         String?  
  donations        AlumniDonation[]
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  school           School   @relation(fields: [schoolId], references: [id])
  student          Student  @relation(fields: [studentId], references: [id])

  @@unique([schoolId, alumniId])
}

model AlumniEvent {
  id          Int      @id @default(autoincrement())
  schoolId    Int
  title       String
  description String
  eventDate   DateTime
  location    String?
  imageUrl    String?
  isPublished Boolean  @default(false)
  authorId    Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  school      School   @relation(fields: [schoolId], references: [id])
}

model AlumniStory {
  id          Int      @id @default(autoincrement())
  schoolId    Int
  title       String
  content     String
  alumniName  String
  graduationYear Int
  imageUrl    String?
  isPublished Boolean  @default(false)
  isFeatured  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  school      School   @relation(fields: [schoolId], references: [id])
}



model PromotionHistory {
  id                Int             @id @default(autoincrement())
  schoolId          Int
  studentId         Int
  fromClassId       Int?
  toClassId         Int?
  academicSessionId Int?
  type              String          @default("promotion") // promotion, graduation, demotion, migration
  notes             String?
  performedBy       Int
  createdAt         DateTime        @default(now())
  
  school            School           @relation(fields: [schoolId], references: [id])
  academicSession   AcademicSession? @relation(fields: [academicSessionId], references: [id])
  fromClass         Class?           @relation("FromClass", fields: [fromClassId], references: [id])
  toClass           Class?           @relation("ToClass", fields: [toClassId], references: [id])
  student           Student          @relation(fields: [studentId], references: [id])
}

model AlumniDonation {
  id          Int      @id @default(autoincrement())
  schoolId    Int
  donorName   String
  amount      Float
  message     String?
  date        DateTime @default(now())
  isAnonymous Boolean  @default(false)
  alumniId    Int?
  
  school      School   @relation(fields: [schoolId], references: [id])
  alumni      Alumni?  @relation(fields: [alumniId], references: [id])
  createdAt   DateTime @default(now())
}

model QuranTarget {
  id                Int             @id @default(autoincrement())
  schoolId          Int
  classId           Int
  academicSessionId Int
  termId            Int
  targetType        String          // memorization, revision
  period            String          // daily, weekly, monthly, termly
  juzStart          Int?
  juzEnd            Int?
  surahStart        String?
  surahEnd          String?
  ayahStart         Int?
  ayahEnd           Int?
  pagesCount        Int?
  description       String?
  startDate         DateTime
  endDate           DateTime
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  school            School          @relation(fields: [schoolId], references: [id])
  class             Class           @relation(fields: [classId], references: [id])
  term              Term            @relation(fields: [termId], references: [id])
  academicSession   AcademicSession @relation(fields: [academicSessionId], references: [id])
}

model QuranRecord {
  id                Int             @id @default(autoincrement())
  schoolId          Int
  studentId         Int
  teacherId         Int
  date              DateTime        @default(now())
  type              String          // memorization, revision
  juz               Int?
  surah             String?
  ayahStart         Int?
  ayahEnd           Int?
  pages             Float?
  status            String          // Excellent, Good, Fair, Poor
  comments          String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  school            School          @relation(fields: [schoolId], references: [id])
  student           Student         @relation(fields: [studentId], references: [id])
  teacher           User            @relation(name: "QuranTeacher", fields: [teacherId], references: [id])
}
